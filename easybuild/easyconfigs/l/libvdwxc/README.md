# EasyBuild libvdwxc installation notes

* [Home page with documentation](https://libvdwxc.org/)
* [GitLab repository](https://gitlab.com/libvdwxc/libvdwxc)

Libvdwxc can be downloaded from two different places
* Using [the tags tab in the GitLab repository](https://gitlab.com/libvdwxc/libvdwxc/-/tags)
    * These files do not yet include `configure`, it can be generated by running `./autogen.sh`.
* From [launchpad.net](https://launchpad.net/libvdwxc/stable/)
    * Sources are only avaiable as .tar.gz files, not as the often more compact .atr.bz2 or .zip 
      files, but they do already contain the `configure` script.

## Dependencies

*Based on version 0.4.0*

* MPI support is optional
* FFTW3 is mandatory
    * It is possible to compile libvdwxc without MPI using MKL and the FFTW3 wrappers from Intel.
      The MPI version of libvdwxc requires FFTW3 with MPI support which the Intel wrappers
      do not provide.
* [PFFT](https://github.com/mpip/pfft) is optional and only for MPI builds. The documentation
  warns that it mostly makes sense for very large problems as in other cases the MPI-version 
  of FFTW3 may very well be faster.

Libvdwxc produces only one set of libraries with the same names for the MPI-aware and 
sequential version. The API is also not split up in MPI and regular versions of the 
functions, but the MPI version adds 3 functions to initialize the library for MPI. 
Hence we suspect that using the MPI-aware libvdwxc library may pose problems in sequential
codes.

## EasyConfig development

* We have chosen to download the sources from GitLab rather than from Launchpad.net 
  as this is also where the source code is maintained. We download the .tar.bz2 version 
  as this is often the most compact file.

### Specific remarks

* libvdwxc-0.4.0-intel-2019b-sequential.eb
    * We need to unset `MPICC` and `MPIFC`, otherwise the configure process will automatically 
      configure for the MPI-aware version. Just to be sure we also pass `--without-mpi` to 
      `configure`, but in fact this generates an error message if `MPICC` and `MPIFC` are set.
    * We need to point `configure` to the Intel FFTW wrapper header files and libraries,
      which we do through the variables `FFTW3_INCLUDES` and `FFTW3_LIBS`. We do also need to 
      include the suitable MKL libraries of course (we use the single threaded ones).
* libvdwxc-0.4.0-intel-2019b-MPI.eb
    * For this variant of the library, a MPI-aware version of FFTW is needed. Hence 
      we use FFTW itself for this variant rather than the Intel FFTW wrappers for MKL.
