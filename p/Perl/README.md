# Perl installation instructions

## General information

* Note that when installing an extension, EasyBuild follows the
  following steps as can be derived from the ``perlmodule`` generic
  EasyBlock:
    * There are two possible installation procedures: either through
      a ``Makefile.PL`` or a ``Build.PL`` script.
    * In case the package is installed through ``Makefile.PL``: 
         * It calls Makefile.PL preceded by ``preconfigopts`` and with
           ``configopts`` appended to the command.
         * It then calls the build, test and install steps as if they would be called
           by ConfigureMake. Hence one can use the options of ConfigureMake
           to influence the build and install behaviour.
    * In case of installing through Build.PL: 
        * It first calls the Build.PL script, preceding with
          ``preconfigopts`` and adding ``configopts`` at the end of the command.
        * Next it calls ``perl Build build`` preceded by prebuildopts
          and with buildopts appended to the command.
        * If ``runtest`` is set, it then calls ``perl Build`` with 
          ``runtest`` as the argument.
        * Finally it calls ``perl Build install`` preceded by ``preinstallopts`` 
          and with ``installopts`` appended to it.

## EasyConfigs

The first version covered by this documentation is 5.30.2 (2020a toolchains)

### 5.30.2 for intel 2020a and matching GCCcore 9.3.0

* Some extensions install without problems in the GCCcore version but fail in 
  the Intel version.
    * XML::Bare: 
         * The problem is in the Makefile of this package. It defines CC
           to be gcc in the Makefile but does not set CFLAGS. Hence CC is not picked
           up from the environment, but CFLAGS is and it tries to compile the extension
           using gcc with options for the Intel compiler which of course bombs. 
           That Makefile is generated by the Perl script Makefile.PL during the
           configuration phase of the extension. The script simply checks for the
           executables ``gcc`` or ``cc`` in the PATH and hard-codes that in the
           CC Makefile variable.
         * Solution: Add ``'buildopts': 'CC="$CC"'``
    * Set::IntervalTree:
         * The problem is similar to that with XML::Bare, except that now ``c++`` is
           hardcoded as the name for the C/C++ compiler. Moreover, it also adds ``-xc++``
           to the CCFLAGS variable in the Makefile that it generates. It does so in a
           line that is already a processed version of the CCFLAGS variable read from
           the environment so it is non-trivial to change through a command line option
           to make in the build step... Luckily the ``-xc++`` does not cause problems
           with the Intel compiler. Otherwise we'd have to edit it out of the generated
           Makefile with a sed command in ``prebuildopts``.
         * Solution: Add ``'buildopts': 'CC="$CXX"'``
